<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">









    <link rel="dns-prefetch" href="https://fonts.googleapis.com"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            R与数据分析 | 
        
        WiiRong&#39;s Blog
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="《R4DS》一书的笔记">
    <meta name="keywords" content=",R语言,数据处理">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?NKhlKQkXw/c66TR5p4wO+w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(/img/bg.png);
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="WiiRong&#39;s Blog">
    <meta name="msapplication-starturl" content="http://yoursite.com/2020/07/16/R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="WiiRong&#39;s Blog">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com/2020/07/16/R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="R与数据分析 | WiiRong&#39;s Blog">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="《R4DS》一书的笔记">
    <meta property="og:article:tag" content="R语言"> <meta property="og:article:tag" content="数据处理"> 

    
        <meta property="article:published_time" content="Thu Jul 16 2020 01:04:28 GMT+0800">
        <meta property="article:modified_time" content="Sun Aug 16 2020 00:19:28 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2020/07/16/R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yoursite.com/2020/07/16/R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/index.html",
    "headline": "R与数据分析",
    "datePublished": "Thu Jul 16 2020 01:04:28 GMT+0800",
    "dateModified": "Sun Aug 16 2020 00:19:28 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "WiiRong",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "苟日新，日日新，又日新"
    },
    "publisher": {
        "@type": "Organization",
        "name": "WiiRong&#39;s Blog",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",R语言,数据处理",
    "description": "《R4DS》一书的笔记",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

<meta name="generator" content="Hexo 4.2.1"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#第一章-Data-visualisation"><span class="post-toc-number">1.</span> <span class="post-toc-text">第一章   Data visualisation</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简述"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">简述</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、初会散点图"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">一、初会散点图</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、使用mpg这一data-frame"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">1、使用mpg这一data frame</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、创建一个ggplot"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">2、创建一个ggplot</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、制图代码模板A-graphing-template"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">3、制图代码模板A graphing template</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、审美映射参数（Aesthetic-mappings）"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">二、审美映射参数（Aesthetic mappings）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、分面作图（Facets）"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">三、分面作图（Facets）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（1）用单个变量进行分面（facet）"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">（1）用单个变量进行分面（facet）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#（2）利用两个变量进行分面"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">（2）利用两个变量进行分面</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、几何对象（Geometric-objects）"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">四、几何对象（Geometric objects）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、geom函数概述"><span class="post-toc-number">1.5.1.</span> <span class="post-toc-text">1、geom函数概述</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、group美学和ggplot2的自动group"><span class="post-toc-number">1.5.2.</span> <span class="post-toc-text">2、group美学和ggplot2的自动group</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、同一plot显示多个geom图形"><span class="post-toc-number">1.5.3.</span> <span class="post-toc-text">3、同一plot显示多个geom图形</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#习题"><span class="post-toc-number">1.5.4.</span> <span class="post-toc-text">习题</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#五、统计学变换（Statistical-transformations）"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">五、统计学变换（Statistical transformations）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#geom与stat的一一对应关系"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">geom与stat的一一对应关系</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#需要明确使用stat的三个原因"><span class="post-toc-number">1.6.2.</span> <span class="post-toc-text">需要明确使用stat的三个原因</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、覆盖默认stat信息"><span class="post-toc-number">1.6.2.1.</span> <span class="post-toc-text">1、覆盖默认stat信息</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、覆盖默认的aes映射（即修改纵轴）"><span class="post-toc-number">1.6.2.2.</span> <span class="post-toc-text">2、覆盖默认的aes映射（即修改纵轴）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3、当我们需要更加注意代码中的统计转换"><span class="post-toc-number">1.6.2.3.</span> <span class="post-toc-text">3、当我们需要更加注意代码中的统计转换</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#习题-1"><span class="post-toc-number">1.6.3.</span> <span class="post-toc-text">习题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#geom和stat的汇总"><span class="post-toc-number">1.6.3.1.</span> <span class="post-toc-text">geom和stat的汇总</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#六、位置调整-（-Position-adjustments）"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">六、位置调整 （ Position adjustments）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、position参数的默认设置：stack-（堆叠）"><span class="post-toc-number">1.7.0.1.</span> <span class="post-toc-text">1、position参数的默认设置：stack （堆叠）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、position-“identity”"><span class="post-toc-number">1.7.0.2.</span> <span class="post-toc-text">2、position &#x3D; “identity”</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3、position-“fill”"><span class="post-toc-number">1.7.0.3.</span> <span class="post-toc-text">3、position &#x3D; “fill”</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4、position-“dodge”"><span class="post-toc-number">1.7.0.4.</span> <span class="post-toc-text">4、position &#x3D; “dodge”</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5、position-“jitter”-用于散点图"><span class="post-toc-number">1.7.0.5.</span> <span class="post-toc-text">5、position &#x3D; “jitter”  (用于散点图)</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#习题-2"><span class="post-toc-number">1.7.0.6.</span> <span class="post-toc-text">习题</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#七、坐标系（Coordinate-systems）"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">七、坐标系（Coordinate systems）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、默认坐标系——笛卡尔坐标"><span class="post-toc-number">1.8.1.</span> <span class="post-toc-text">1、默认坐标系——笛卡尔坐标</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、coord-flip-切换横纵轴"><span class="post-toc-number">1.8.2.</span> <span class="post-toc-text">2、coord_flip()  切换横纵轴</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、coord-quickmap-正确设置地图的纵横比"><span class="post-toc-number">1.8.3.</span> <span class="post-toc-text">3、coord_quickmap()  正确设置地图的纵横比</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、coord-polar-极坐标"><span class="post-toc-number">1.8.4.</span> <span class="post-toc-text">4、coord_polar()  极坐标</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#习题-3"><span class="post-toc-number">1.8.5.</span> <span class="post-toc-text">习题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、画出饼图"><span class="post-toc-number">1.8.5.1.</span> <span class="post-toc-text">1、画出饼图</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、标签函数-What-does-labs-do-Read-the-documentation"><span class="post-toc-number">1.8.5.2.</span> <span class="post-toc-text">2、标签函数 What does labs() do? Read the documentation.</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#八、图层语法The-layered-grammar-of-graphics"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">八、图层语法The layered grammar of graphics</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#第二章-Data-transformation"><span class="post-toc-number">2.</span> <span class="post-toc-text">第二章 Data transformation</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、Introduction"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">一、Introduction</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、用filter（）筛选行"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">二、用filter（）筛选行</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、比较运算符（comparisons-operator）"><span class="post-toc-number">2.2.1.</span> <span class="post-toc-text">1、比较运算符（comparisons operator）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、逻辑运算符（logical-operator）"><span class="post-toc-number">2.2.2.</span> <span class="post-toc-text">2、逻辑运算符（logical operator）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、缺失值（-Missing-values）"><span class="post-toc-number">2.2.3.</span> <span class="post-toc-text">3、缺失值（ Missing values）</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、Exercises"><span class="post-toc-number">2.2.4.</span> <span class="post-toc-text">4、Exercises</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、重新排序行Arrange-rows-with-arrange"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">三、重新排序行Arrange rows with arrange()</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#习题-4"><span class="post-toc-number">2.3.1.</span> <span class="post-toc-text">习题</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、使用select（）选择columns列"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">四、使用select（）选择columns列</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#习题-5"><span class="post-toc-number">2.4.1.</span> <span class="post-toc-text">习题</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#五、使用mutate（）添加新的变量"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">五、使用mutate（）添加新的变量</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#可在mutate（）中使用的函数"><span class="post-toc-number">2.5.1.</span> <span class="post-toc-text">可在mutate（）中使用的函数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#（1）算数运算符（Arithmetic-operator）"><span class="post-toc-number">2.5.1.1.</span> <span class="post-toc-text">（1）算数运算符（Arithmetic operator）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#（2）模运算（Modular-arithmetic）"><span class="post-toc-number">2.5.1.2.</span> <span class="post-toc-text">（2）模运算（Modular arithmetic）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#（3）对数运算符（logarithms）"><span class="post-toc-number">2.5.1.3.</span> <span class="post-toc-text">（3）对数运算符（logarithms）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#（4）偏移量（offsets）"><span class="post-toc-number">2.5.1.4.</span> <span class="post-toc-text">（4）偏移量（offsets）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#（5）累计和滚动聚合（Cumulative-and-rolling-aggregates）"><span class="post-toc-number">2.5.1.5.</span> <span class="post-toc-text">（5）累计和滚动聚合（Cumulative and rolling aggregates）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#（6）逻辑比较（logical-comparisons）"><span class="post-toc-number">2.5.1.6.</span> <span class="post-toc-text">（6）逻辑比较（logical comparisons）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#（7）排序（Ranking）"><span class="post-toc-number">2.5.1.7.</span> <span class="post-toc-text">（7）排序（Ranking）</span></a></li></ol></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                R与数据分析
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>WiiRong</strong>
        <span>7月 16, 2020</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/R%E8%AF%AD%E8%A8%80/" rel="tag">R语言</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86/" rel="tag">数据处理</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=R与数据分析&url=http://yoursite.com/2020/07/16/R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/index.html&pic=http://yoursite.com/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=R与数据分析&url=http://yoursite.com/2020/07/16/R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/index.html&via=WiiRong" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com/2020/07/16/R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="第一章-Data-visualisation"><a href="#第一章-Data-visualisation" class="headerlink" title="第一章   Data visualisation"></a>第一章   Data visualisation</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p>In <a href="https://r4ds.had.co.nz/data-visualisation.html#data-visualisation" target="_blank" rel="noopener">data visualisation</a> you’ll dive into visualisation, learning the basic structure of a <strong>ggplot2</strong> plot, and powerful techniques for <u>turning data into plots</u>.You get to make elegant and informative plots that help you understand data.</p>
<p>This chapter focusses on <strong>ggplot2</strong>, one of the core members of the <strong>==tidyverse==</strong>. To access the <u>datasets</u>, <u>help pages</u>, and <u>functions</u> that we will use in this chapter, <strong>load the tidyverse</strong> by running this code:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(tidyverse)</span><br></pre></td></tr></table></figure>

<p>tidyverse包含了数据分析最常用的包，调用后得到的結果如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(tidyverse)</span><br><span class="line"><span class="comment">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</span></span><br><span class="line"><span class="comment">#&gt; ✔ ggplot2 3.3.0     ✔ purrr   0.3.4</span></span><br><span class="line"><span class="comment">#&gt; ✔ tibble  3.0.1     ✔ dplyr   0.8.5</span></span><br><span class="line"><span class="comment">#&gt; ✔ tidyr   1.0.3     ✔ stringr 1.4.0</span></span><br><span class="line"><span class="comment">#&gt; ✔ readr   1.3.1     ✔ forcats 0.5.0</span></span><br><span class="line"><span class="comment">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span><br><span class="line"><span class="comment">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span><br><span class="line"><span class="comment">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span><br></pre></td></tr></table></figure>

<p>其中，对勾项意为启用了这些<em>R包</em>，而冲突项（X）意为<strong>tidyverse</strong>与R的几个基础函数冲突。dplyr::filter()里的双冒号左边代表R包名，右边代表具体函数；发生冲突时，想要调用被冲突掉的函数需要使用stats::filter()`这一写法，即可。</p>
<blockquote>
<p>You only need to install a package once, but you need to <strong>reload</strong> it every time you start a new session.      ——每个任务都要重新调用所需R包</p>
</blockquote>
<h2 id="一、初会散点图"><a href="#一、初会散点图" class="headerlink" title="一、初会散点图"></a>一、初会散点图</h2><h3 id="1、使用mpg这一data-frame"><a href="#1、使用mpg这一data-frame" class="headerlink" title="1、使用mpg这一data frame"></a>1、使用mpg这一data frame</h3><p>使用ggplot2自带的数据： <code>mpg</code> <strong>data frame</strong> found in ggplot2 (aka <code>ggplot2::mpg</code>). </p>
<blockquote>
<p>A ==<strong>data frame</strong>== is a rectangular collection of variables (in the columns) and observations (in the rows).<br>（<code>mpg</code> contains observations collected by the US Environmental Protection Agency on 38 models of car.）</p>
</blockquote>
<p>通过 <em>mpg</em> 查看此数据框的详情，通过  <em>?mpg</em>  查看其帮助文档。</p>
<h3 id="2、创建一个ggplot"><a href="#2、创建一个ggplot" class="headerlink" title="2、创建一个ggplot"></a>2、创建一个ggplot</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) +</span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy))</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>函数/参数</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>ggplot</strong>（）</td>
<td>创建一个空坐标系（通过下句函数添加图层）</td>
</tr>
<tr>
<td><strong>data=</strong> mpg</td>
<td>ggplot的第一个参数，确定图中使用的数据（dataset）</td>
</tr>
<tr>
<td>geom_point（）</td>
<td>向plot添加一个<strong>散点图</strong>图层</td>
</tr>
<tr>
<td>mapping</td>
<td>geom函数必备参数，决定了dataset中的数据如何<u>映射（map）</u>成为视觉表现</td>
</tr>
<tr>
<td>mapping=aes()</td>
<td>aesthetic（审美）参数，内含有横纵坐标x、y</td>
</tr>
</tbody></table>
<p>函数中的重点如下：<br>ggplot(==data === mpg) ==+==<br>  geom_point(==mapping = aes==(x = displ, y = hwy))</p>
<p>{注}ggplot（）函数和geom_point（）函数之间用 <strong>+</strong> 连接，可以不换行直接运行，若换行（缩进格式谋求规范书写）的话，加号必须在上句的最后（若在下句的开始则会出错）。</p>
<h3 id="3、制图代码模板A-graphing-template"><a href="#3、制图代码模板A-graphing-template" class="headerlink" title="3、制图代码模板A graphing template"></a>3、制图代码模板A graphing template</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = &lt;DATA&gt;) + </span><br><span class="line">  &lt;GEOM_FUNCTION&gt;(mapping = aes(&lt;MAPPINGS&gt;))</span><br></pre></td></tr></table></figure>

<p>用数据、geom函数、映射参数替换上述中含有&lt;&gt;的部分。本章接下来部分 will show you how to complete and extend this <strong>template</strong> to make different types of graphs. We will begin with the <code>&lt;MAPPINGS&gt;</code> component.</p>
<blockquote>
<p>注：参数的英文是argument</p>
<p>map有映射的含义，mapping在此意为映射参数</p>
</blockquote>
<h2 id="二、审美映射参数（Aesthetic-mappings）"><a href="#二、审美映射参数（Aesthetic-mappings）" class="headerlink" title="二、审美映射参数（Aesthetic mappings）"></a>二、审美映射参数（Aesthetic mappings）</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按照样本的class变量进行区分，绘制成不同透明度的点</span></span><br><span class="line">ggplot(data = mpg) + </span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照样本的class变量进行区分，绘制成不同的形状的点</span></span><br><span class="line">ggplot(data = mpg) + </span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy, shape = class))</span><br></pre></td></tr></table></figure>

<p>ggplot2将会<strong>自动添加图例（legend）</strong>在plot旁边。还可以自动为所选变量class的每个惟一值分配惟一的审美级别（这一过程叫做<strong>scaling</strong>）。</p>
<table>
<thead>
<tr>
<th>aes（）内的审美参数</th>
<th>用法：aes（x= ，Y= ，color= 某类型变量）</th>
</tr>
</thead>
<tbody><tr>
<td>color</td>
<td>自动上色</td>
</tr>
<tr>
<td>size</td>
<td>赋予数据点不同的直径</td>
</tr>
<tr>
<td>alpha</td>
<td>透明度</td>
</tr>
<tr>
<td>shape</td>
<td>赋予最多 6 种不同的形状（超出部分不予绘制）</td>
</tr>
</tbody></table>
<blockquote>
<p>调用  ?geo_point  帮助文档可以找到这些审美参数（其中的Aesthetics部分）。可以看到全部aesthetics映射参数的预览效果和使用方法。</p>
</blockquote>
<p>如果将上述审美参数写在  mapping=aes（）之外，而在geo_point（）函数之内，则图中全部点全部设置为同一种 颜色，此时color后面不跟variable名而是加引号的颜色的名字：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) + </span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy), color = <span class="string">"blue"</span>)</span><br></pre></td></tr></table></figure>

<h2 id="三、分面作图（Facets）"><a href="#三、分面作图（Facets）" class="headerlink" title="三、分面作图（Facets）"></a>三、分面作图（Facets）</h2><p>上面讲的审美参数能够引入第三个（甚至更多）变量进入plot中，而现在所讲的分面作图（Facets）也可以起到这一效果。</p>
<h3 id="（1）用单个变量进行分面（facet）"><a href="#（1）用单个变量进行分面（facet）" class="headerlink" title="（1）用单个变量进行分面（facet）"></a>（1）用单个变量进行分面（facet）</h3><p>在绘制完ggplot和geom散点图之后，运用函数 facet_wrap（）可以进行单变量分隔面作图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) + </span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy)) + </span><br><span class="line">  facet_wrap(~ class, nrow = <span class="number">2</span>)</span><br><span class="line"><span class="comment">#下图共有三个变量参与制图</span></span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/7b70e5c694d661644e49bcaa2fa8d923007cf718/b117d/visualize_files/figure-html/unnamed-chunk-12-1.png" alt="img"></p>
<p>图中每个小面都将其对应的变量名写在小面图的上方。</p>
<p>facet_wrap（）函数中有两个参数：第一个参数是 <strong>formula</strong>（表达式——R语言中的一种数据结构），用波浪符号  ~  隔开两个参数，在wrap（）中无响应变量所以左边空置。</p>
<p>第二个参数是对分面小图的展示行数进行设置，用  nrow=   进行设置，竟在facet_wrap（）中使用。（下一节的facet_grid（）无此参数）</p>
<blockquote>
<p>facet_wrap(~class, scales = “free”)         ##分面可以用不同的坐标系，默认为scales=”fixed”.<br> facet_wrap(c(“cyl”, “drv”), labeller = “label_both”)         ## 同过c()函数，facet_wrap()也可实现两个变量的分面，通过labeller参数控制 标签显示更加完全。</p>
</blockquote>
<h3 id="（2）利用两个变量进行分面"><a href="#（2）利用两个变量进行分面" class="headerlink" title="（2）利用两个变量进行分面"></a>（2）利用两个变量进行分面</h3><p>用函数  facet_grid（）进行，其中的formula参数用 ~连接两个变量variables。</p>
<p>但是可以用符号  .   来代替其中一个变量，使得结果不在该变量所对应的行（列）上进行分割面。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) + </span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy)) + </span><br><span class="line">  facet_grid(drv ~ cyl)</span><br><span class="line"><span class="comment">#结果图中的三行代表三种drv类型，而四列代表cyl的四个类型值。</span></span><br><span class="line"><span class="comment">#下图共有 4 个变量参与制图</span></span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/94b029204c691b958eb0c60c6915a19ee4d319bf/ceeb1/visualize_files/figure-html/unnamed-chunk-13-1.png" alt="img"></p>
<h2 id="四、几何对象（Geometric-objects）"><a href="#四、几何对象（Geometric-objects）" class="headerlink" title="四、几何对象（Geometric objects）"></a>四、几何对象（Geometric objects）</h2><p>​    本节讲述不同的  geom   函数。</p>
<h3 id="1、geom函数概述"><a href="#1、geom函数概述" class="headerlink" title="1、geom函数概述"></a>1、geom函数概述</h3><table>
<thead>
<tr>
<th>图形</th>
<th>geom函数</th>
</tr>
</thead>
<tbody><tr>
<td>bar charts（条形图）</td>
<td>bar geoms</td>
</tr>
<tr>
<td>line charts（折线图）</td>
<td>line geoms</td>
</tr>
<tr>
<td>boxplots（箱线图）</td>
<td>boxplot geoms</td>
</tr>
<tr>
<td>scatterplots（散点图）</td>
<td>point geom</td>
</tr>
</tbody></table>
<p>使用  ==<strong>geom_smooth（）</strong>==函数如下，输出图片如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) +    </span><br><span class="line">  geom_smooth(mapping = aes(x = displ, y = hwy))           <span class="comment">#下左图</span></span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/3e4d5a44b35d0de122c81319995d5dcf484e6d71/7fb04/visualize_files/figure-html/unnamed-chunk-17-2.png" alt="img" style="zoom:25%;" /><img src="https://d33wubrfki0l68.cloudfront.net/33b14521b673a6384c302e3df3008d1c3c034c6b/d3285/visualize_files/figure-html/unnamed-chunk-19-1.png" alt="img" style="zoom:25%;" /></p>
<p>ggplot2中的每个geom函数都带有一个mapping  argument（映射参数）。 但是，并非每一种aesthetic（美学参数）都适用于每一种geom。例如：可以设置geom_point（）函数的shape；而geom_smooth（）（绘制line）则不能设置shape，却可以设置linetype参数。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) +    </span><br><span class="line">  geom_smooth(mapping = aes(x = displ, y = hwy,linetype = drv))   <span class="comment">#上右图</span></span><br></pre></td></tr></table></figure>

<p>ggplot2提供了40多种geom函数，可以看<a href="https://exts.ggplot2.tidyverse.org/gallery/" target="_blank" rel="noopener">https://exts.ggplot2.tidyverse.org/gallery/</a>    。也可以看cheatsheet获得全面概述。了解单个geom函数的方法是用<code>? geom_smooth</code>查看帮助。</p>
<h3 id="2、group美学和ggplot2的自动group"><a href="#2、group美学和ggplot2的自动group" class="headerlink" title="2、group美学和ggplot2的自动group"></a>2、group美学和ggplot2的自动group</h3><p>许多geom函数（如geom_smooth）都使用单个geometric object来显示多行数据，对于这些geom函数，可以将  <strong>group</strong>参数（是美学参数，在mapping=aes（）内部）设置为一个categorical variables（分类变量）以此达到绘制多个对象的目的。<img src="https://d33wubrfki0l68.cloudfront.net/2cd610393a828d04520144a1ff8bf669d2b9d790/86222/visualize_files/figure-html/unnamed-chunk-21-2.png" alt="img" style="zoom: 50%;" /></p>
<p>但是，每当你将一个美学参数映射到discrete variables（离散变量）的时候，ggplot2都会<strong>自动</strong>将这些geoms中的数据进行分组。<img src="https://d33wubrfki0l68.cloudfront.net/6cb48f7f00aa119aab0db977306e6c0cd996a8d8/e4c41/visualize_files/figure-html/unnamed-chunk-21-3.png" alt="img" style="zoom: 50%;" /></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) +   </span><br><span class="line">  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))      </span><br><span class="line">ggplot(data = mpg) +   </span><br><span class="line">  geom_smooth(mapping = aes(x = displ, y = hwy, color = drv),show.legend = <span class="literal">FALSE</span>)</span><br><span class="line"><span class="comment">#show.legend 后跟逻辑值，意为是否显示图例，默认为TRUE显示图例</span></span><br></pre></td></tr></table></figure>

<h3 id="3、同一plot显示多个geom图形"><a href="#3、同一plot显示多个geom图形" class="headerlink" title="3、同一plot显示多个geom图形"></a>3、同一plot显示多个geom图形</h3><p>将多个geom函数添加到 ggplot（）中：<img src="https://d33wubrfki0l68.cloudfront.net/62d36d8b7ebbc5ef9e97d3365e201a687214345b/5fbee/visualize_files/figure-html/unnamed-chunk-22-1.png" alt="img" style="zoom:25%;" /></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) + </span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy)) +</span><br><span class="line">  geom_smooth(mapping = aes(x = displ, y = hwy))</span><br></pre></td></tr></table></figure>

<p>上述代码<strong>等价于</strong>以下<strong>简化</strong>的代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + </span><br><span class="line">    geom_point() + </span><br><span class="line">    geom_smooth()</span><br></pre></td></tr></table></figure>

<p>在简化代码的基础上可以赋予每一个geom函数各自的本地映射（每个geom函数里的映射），它将仅使用这些映射来扩展或覆盖当前图层（layer）的全局映射（ggplot（）里的mapping）。举例仅仅绘制普通的smooth线图，而在散点图中按照车辆类型进行group，如下例：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +</span><br><span class="line">  geom_point(mapping = aes(color = class)) +</span><br><span class="line">  geom_smooth()</span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/7891327afa80293f32eeb1537a8bc5eeeb080a5f/b81cb/visualize_files/figure-html/unnamed-chunk-24-1.png" alt="img" style="zoom: 33%;" />

<p>或者我们给两个图层赋予不同的本地映射如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +</span><br><span class="line">  geom_point(mapping = aes(color = class)) +</span><br><span class="line">  geom_smooth(data = filter(mpg, class == <span class="string">"subcompact"</span>), se = <span class="literal">FALSE</span>)</span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/9fd0c1378ccf6c177c4e69a979eb7a6ec83a7046/210c2/visualize_files/figure-html/unnamed-chunk-25-1.png" alt="img" style="zoom: 50%;" />

<blockquote>
<p>上图中，geom_smooth（）函数将所用数据缩小，利用其内部的data参数所被<strong>传递（等号=用于传递，而非赋值）</strong>的新的子数据集 覆盖了全局参数<code>data = mpg</code> 。</p>
<p>filter来自司职<strong>数据处理</strong>的<strong>dplyr</strong>包，选取了mpg数据集内class变量的值为subcompact的子集。通过 = 将filter传递给data参数。</p>
<p>再令 <strong>se</strong> = FALSE实现“去除confidence interval（置信区间）即去除阴影范围”的功能（默认为TRUE）</p>
</blockquote>
<h3 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h3><p>1、What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?【看ggplot2的cheatsheet即可，直观简洁】</p>
<table>
<thead>
<tr>
<th>图形</th>
<th>geom函数</th>
</tr>
</thead>
<tbody><tr>
<td>折线图line chart</td>
<td>geom_line()</td>
</tr>
<tr>
<td>直方/柱形histogram</td>
<td>geom_histogram(binwidth = 5)</td>
</tr>
<tr>
<td>面积图area chart</td>
<td>geom_area()</td>
</tr>
<tr>
<td>箱线图boxplot</td>
<td>geom_boxplot()</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>2、Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.【mpg例displ和hwy分作x、y轴，将drv映射到color参数自动分组，此plot共有两个图层：散点图和拟合线图，其中线图关闭了置信区间阴影】【实操后补充：线图也区分了颜色】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; mpg, mapping &#x3D; aes(x &#x3D; displ, y &#x3D; hwy, color &#x3D; drv)) +</span><br><span class="line">  geom_point() +</span><br><span class="line">  geom_smooth(se &#x3D; FALSE)</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5C90359%5CPictures%5Cr%E5%8F%AF%E8%A7%86%E5%8C%96.png" alt="image-20200722231723135"></p>
<p>3、Recreate the R code necessary to generate the following graphs.</p>
<img src="https://d33wubrfki0l68.cloudfront.net/b819dffae32e7f12c87a8bbd580560f317f4523a/f6b1e/visualize_files/figure-html/unnamed-chunk-28-1.png" alt="img" style="zoom: 33%;" />

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; mpg, mapping &#x3D; aes(x &#x3D; displ, y &#x3D; hwy)) +</span><br><span class="line">   geom_point() +</span><br><span class="line">   geom_smooth(color&#x3D;&quot;blue&quot;,se &#x3D; FALSE)</span><br></pre></td></tr></table></figure>

<img src="C:\Users\90359\Pictures\r可视.png" alt="image-20200723003459201" style="zoom:50%;" />

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; mpg, mapping &#x3D; aes(x &#x3D; displ, y &#x3D; hwy)) + </span><br><span class="line">  geom_point() +</span><br><span class="line">  geom_smooth(color&#x3D;&quot;blue&quot;,se &#x3D; FALSE,aes(group&#x3D;drv))</span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/c189c975d29a9ae1cfdc306aa97f5f681725ed6d/59935/visualize_files/figure-html/unnamed-chunk-28-3.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; mpg, mapping &#x3D; aes(x &#x3D; displ, y &#x3D; hwy, color &#x3D; drv )) +</span><br><span class="line">  geom_point() +</span><br><span class="line">  geom_smooth(se &#x3D; FALSE)</span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/86d4021ffb223d8aa907afc2cc1258f1d1f8e660/485cd/visualize_files/figure-html/unnamed-chunk-28-5.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; mpg, mapping &#x3D; aes(x &#x3D; displ, y &#x3D; hwy,color&#x3D;drv)) +</span><br><span class="line">  geom_point() +</span><br><span class="line">  geom_smooth(se &#x3D; FALSE,aes(linetype &#x3D; drv),color&#x3D;&quot;blue&quot;)</span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/ec80e012d371b22f36c7c88f714bc9f376b9492d/2affc/visualize_files/figure-html/unnamed-chunk-28-6.png" alt="img"></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(mpg, aes(x = displ, y = hwy)) +</span><br><span class="line">  geom_point(size = <span class="number">4</span>, color = <span class="string">"white"</span>) +</span><br><span class="line">  geom_point(aes(colour = drv))</span><br><span class="line"><span class="comment">#这是叠了两层point，答案参考自https://jrnold.github.io/r4ds-exercise-solutions/data-visualisation.html#statistical-transformations</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>习题笔记：</p>
<p>1、<strong>color =drv</strong>  的时候，变量名drv无需加引号。当<strong>color = “blue”</strong>时，颜色“blue”必须加引号；<br>     2、<strong>mapping=aes（）</strong>可以简写为 <strong>aes（）</strong>；<br>     3、将变量<strong>映射（mapping）</strong>到参数的时候，必须在<strong>aes（）</strong>【即mapping=aes（）】里面，这就是mapping=这个前缀不能省略的理由；<br>     4、geom函数中通用的mapping=aes（）参数如坐标轴、颜色分组等，写在每一个geom（）里和写在ggplot（）里是<strong>完全等价</strong>的！</p>
</blockquote>
<h2 id="五、统计学变换（Statistical-transformations）"><a href="#五、统计学变换（Statistical-transformations）" class="headerlink" title="五、统计学变换（Statistical transformations）"></a>五、统计学变换（Statistical transformations）</h2><p>本章讲述geom（）函数内部的  stat  这一参数。The algorithm used to calculate new values for a graph is called a <strong>stat</strong>, short for statistical transformation. 对图形进行计算新的值的算法，叫做stat。</p>
<h3 id="geom与stat的一一对应关系"><a href="#geom与stat的一一对应关系" class="headerlink" title="geom与stat的一一对应关系"></a>geom与stat的一一对应关系</h3><p>通过查看geom函数的帮助<code>?geom_bar</code>即可看到各个geom函数中stat的默认值是什么。<strong>geom_bar中stat的默认值为stat = “count”</strong>，这意味着<strong>geom_ bar（）使用stat_count（）</strong>。这意味着这二者可以呼唤，即使用<strong>geom_ bar（）</strong>和<strong>stat_count（）</strong>会产生同样的效果【能这样做的原因是：每个geom都有默认的stat，而每个stat都有默认的geom】：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gplot(data = diamonds) +    </span><br><span class="line">  stat_count(mapping = aes(x = cut))</span><br><span class="line"><span class="comment">#等价于</span></span><br><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut))</span><br><span class="line"> <span class="comment">#都会输出下图</span></span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/80ff107e58e5bcfd21defc93467f2b3ed8ac7d07/60b92/visualize_files/figure-html/unnamed-chunk-31-1.png" alt="img" style="zoom:33%;" />

<h3 id="需要明确使用stat的三个原因"><a href="#需要明确使用stat的三个原因" class="headerlink" title="需要明确使用stat的三个原因"></a>需要明确使用stat的三个原因</h3><p>根据上段所说，geom与stat存在一一对应关系，这意味着可以使用几何，而不必担心基础统计转换，但在下面三种情况下需要使用统计信息：</p>
<h4 id="1、覆盖默认stat信息"><a href="#1、覆盖默认stat信息" class="headerlink" title="1、覆盖默认stat信息"></a>1、覆盖默认stat信息</h4><p>bar的默认stat是count，如果将count改成identity，就可以将绘制单变量离散数据的<strong>geom_bar</strong>（）<strong>变成（完全等价）</strong>绘制双变量离散或连续数据的<strong>geom_col（）</strong>函数。这俩函数具有相同的help文档：</p>
<blockquote>
<p>There are two types of bar charts: <strong>geom_bar()</strong> and <strong>geom_col()</strong>. geom_bar() makes the height（纵轴） of the bar proportional to the <u>number of cases in each group</u> (or if the weight aesthetic is supplied, the sum of the weights). If you want the heights of the bars to <u>represent values in the data</u>, use geom_col() instead. 总结：geom_<strong>bar</strong>() uses <strong>stat_count()</strong> by default: it <strong>counts the number of cases at each x position</strong>. 而geom_col() uses <strong>stat_identity</strong>(): it <strong>leaves the data as is</strong>.</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这种修改在aes（）外，而在geom（）内（现编一个数据demo）</span></span><br><span class="line">demo &lt;- tribble(   ~cut,         ~freq,   <span class="string">"Fair"</span>,       <span class="number">1610</span>,   <span class="string">"Good"</span>,       <span class="number">4906</span>,   <span class="string">"Very Good"</span>,  <span class="number">12082</span>,   <span class="string">"Premium"</span>,    <span class="number">13791</span>,   <span class="string">"Ideal"</span>,      <span class="number">21551</span> )  </span><br><span class="line">ggplot(data = demo) +   </span><br><span class="line">  geom_bar(mapping = aes(x = cut, y = freq), stat = <span class="string">"identity"</span>)</span><br><span class="line"><span class="comment">#此时geom_bar（）就等价于  geom_col(mapping = aes(x = cut, y = freq))</span></span><br></pre></td></tr></table></figure>

<h4 id="2、覆盖默认的aes映射（即修改纵轴）"><a href="#2、覆盖默认的aes映射（即修改纵轴）" class="headerlink" title="2、覆盖默认的aes映射（即修改纵轴）"></a>2、覆盖默认的aes映射（即修改纵轴）</h4><p>You might want to override the default mapping from transformed variables to aesthetics. For example, you might want to display a bar chart of proportion（比率，比例）, rather than count:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, y = stat(prop), group = <span class="number">1</span>))</span><br><span class="line"><span class="comment">#注意这个stat写在【aes（）内部】了</span></span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/bd4332d1e865f0dd2b19be09c70fcd6d458b716d/92872/visualize_files/figure-html/unnamed-chunk-33-1.png" alt="img" style="zoom:33%;" />

<blockquote>
<p>可以在每个geom（）函数的help文档里的computed variables部分找到该geom函数中的stat计算模式</p>
</blockquote>
<h4 id="3、当我们需要更加注意代码中的统计转换"><a href="#3、当我们需要更加注意代码中的统计转换" class="headerlink" title="3、当我们需要更加注意代码中的统计转换"></a>3、当我们需要更加注意代码中的统计转换</h4><p>例如，可以使用stat_summary（）来汇总每个唯一x值的y值，以引起对正在计算的摘要的注意：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +    </span><br><span class="line">  stat_summary(mapping = aes(x = cut, y = depth),</span><br><span class="line">               fun.ymin = min,</span><br><span class="line">               fun.ymax = max,</span><br><span class="line">               fun.y = median   )</span><br><span class="line"><span class="comment">#fun.ymin等用法详见 ？stat_summary  文档</span></span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/d28677d83884efbb1bb3e154fcb3a8b4ad33c5a6/93328/visualize_files/figure-html/unnamed-chunk-34-1.png" alt="img" style="zoom:33%;" />

<blockquote>
<p>ggplot2 provides over 20 stats for you to use. Each stat is a function, so you can get help in the usual way, e.g. <strong>?stat_bin</strong>（这只是其中一个函数，使用此句会进入这个stat对应的geom（）函数的帮助文档）. To see a complete list of stats, try the <strong>ggplot2</strong> <strong>cheatsheet</strong>.</p>
</blockquote>
<h3 id="习题-1"><a href="#习题-1" class="headerlink" title="习题"></a>习题</h3><p>1、What is the default geom associated with stat_summary()? How could you rewrite the previous plot to use that geom function instead of the stat function?</p>
<p>【查看  <strong>？stat_summary</strong>  ，发现此help文档的第一行为<strong>stat_summary_bin {ggplot2}</strong>，其作用（标题）为<strong>Summarise y values at unique/binned x</strong>，其中  <strong>/</strong>  符号的意思是<strong>stat_summary</strong>() operates on <strong>unique</strong> x or y;而<strong>stat_summary_bin</strong>() operates on <strong>binned</strong> x or y.】</p>
<blockquote>
<p>The default geom for <strong>stat_summary</strong>() is <strong>geom_pointrange</strong>(). The default stat for <strong>geom_pointrange</strong>() is <strong>identity</strong>() but we can add the argument <strong>stat = “summary”</strong> to use stat_summary() instead of stat_identity()</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_pointrange(mapping = aes(x = cut, y = depth), stat = <span class="string">"summary"</span>,</span><br><span class="line">                 fun.min = min,</span><br><span class="line">                 fun.max = max,</span><br><span class="line">                 fun = median )</span><br><span class="line"><span class="comment">#这段代码与上段代码完全等效</span></span><br></pre></td></tr></table></figure>

<p>【stat_summary对应什么geom函数？】statsummary帮助文档里有句：See Also ：geom_errorbar(), geom_pointrange(), geom_linerange(), geom_crossbar() for geoms to display summarised data（geom函数都是蓝色超链接，能连接到其help），能看到这些geom函数的stat的默认值都是identity，所以需要在geom（）中进行修改，用stat = “summary”覆盖默认stat设置。后续报错则认真阅读修改即可。</p>
<p>2、Most geoms and stats come in pairs that are almost always used in concert. Read through the documentation and make a list of all the pairs. What do they have in common?</p>
<h4 id="geom和stat的汇总"><a href="#geom和stat的汇总" class="headerlink" title="geom和stat的汇总"></a>geom和stat的汇总</h4><table>
<thead>
<tr>
<th>geom</th>
<th>stat</th>
</tr>
</thead>
<tbody><tr>
<td><code>geom_bar()</code></td>
<td><code>stat_count()</code></td>
</tr>
<tr>
<td><code>geom_bin2d()</code></td>
<td><code>stat_bin_2d()</code></td>
</tr>
<tr>
<td><code>geom_boxplot()</code></td>
<td><code>stat_boxplot()</code></td>
</tr>
<tr>
<td><code>geom_contour_filled()</code></td>
<td><code>stat_contour_filled()</code></td>
</tr>
<tr>
<td><code>geom_contour()</code></td>
<td><code>stat_contour()</code></td>
</tr>
<tr>
<td><code>geom_count()</code></td>
<td><code>stat_sum()</code></td>
</tr>
<tr>
<td><code>geom_density_2d()</code></td>
<td><code>stat_density_2d()</code></td>
</tr>
<tr>
<td><code>geom_density()</code></td>
<td><code>stat_density()</code></td>
</tr>
<tr>
<td><code>geom_dotplot()</code></td>
<td><code>stat_bindot()</code></td>
</tr>
<tr>
<td><code>geom_function()</code></td>
<td><code>stat_function()</code></td>
</tr>
<tr>
<td><code>geom_sf()</code></td>
<td><code>stat_sf()</code></td>
</tr>
<tr>
<td><code>geom_sf()</code></td>
<td><code>stat_sf()</code></td>
</tr>
<tr>
<td><code>geom_smooth()</code></td>
<td><code>stat_smooth()</code></td>
</tr>
<tr>
<td><code>geom_violin()</code></td>
<td><code>stat_ydensity()</code></td>
</tr>
<tr>
<td><code>geom_hex()</code></td>
<td><code>stat_bin_hex()</code></td>
</tr>
<tr>
<td><code>geom_qq_line()</code></td>
<td><code>stat_qq_line()</code></td>
</tr>
<tr>
<td><code>geom_qq()</code></td>
<td><code>stat_qq()</code></td>
</tr>
<tr>
<td><code>geom_quantile()</code></td>
<td><code>stat_quantile()</code></td>
</tr>
</tbody></table>
<p>上表中These pairs of geoms and stats tend to have their names in common, such stat_smooth() and geom_smooth() and be documented on the same help page. The pairs of geoms and stats that are used in concert often have each other as the default stat (for a geom) or geom (for a stat).</p>
<blockquote>
<p>全部geom所对应的默认stat的表不好复制，可以去课后题答案网页细看。</p>
<p>很多geom函数的默认stat是<strong>identity（）</strong>，这时geom和stat各有各自的help文档。</p>
</blockquote>
<p>3、What variables does stat_smooth() compute? What parameters（参数） control its behaviour?</p>
<p>【在help中的Computed variables标题下：</p>
<table>
<thead>
<tr>
<th>计算变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>y</td>
<td>predicted value</td>
</tr>
<tr>
<td>ymin</td>
<td>lower value of the confidence interval</td>
</tr>
<tr>
<td>ymax</td>
<td>upper value of the confidence interval</td>
</tr>
<tr>
<td>se</td>
<td>standard error</td>
</tr>
</tbody></table>
<p>4、In our proportion bar chart, we need to set group = 1. Why? In other words what is the problem with these two graphs?</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, y = ..prop..)) </span><br><span class="line"></span><br><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, fill = color, y = ..prop..))</span><br><span class="line"><span class="comment">#这两个的问题都是“比例在组内计算（proportions are calculated within the groups）”，所以画出来的图全部都是height = 1的统一高度的柱形图。</span></span><br></pre></td></tr></table></figure>

<p>答：比例图（proportion bar chart）里面，如果不设置group=1，会导致所有柱形高度相同（都为1）【原理：The function geom_bar() assumes that the groups are equal to the x values since the stat computes the counts within the group.】</p>
<p>想要使用 fill aesthetic, the heights of the bars need to be normalized（标准化）如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> ggplot(data = diamonds) + </span><br><span class="line">   geom_bar(aes(x = cut, y = ..count.. / sum(..count..), fill = color))</span><br><span class="line"><span class="comment">#纵坐标y是分式，除以了总数</span></span><br><span class="line"><span class="comment">#count除以count的结果也是prop，所以下图等于正文中prop比例图，按照颜色分配而已</span></span><br></pre></td></tr></table></figure>

<p>   <img src="R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90.assets/image-20200723213311962.png" alt="image-20200723213311962"></p>
<blockquote>
<p>注意这是比例图，不是计数图</p>
</blockquote>
<h2 id="六、位置调整-（-Position-adjustments）"><a href="#六、位置调整-（-Position-adjustments）" class="headerlink" title="六、位置调整 （ Position adjustments）"></a>六、位置调整 （ <strong>Position</strong> adjustments）</h2><p>在审美参数ase（）中使用  fill  或者  color  可以达到上色的效果</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, colour = cut))</span><br><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, fill = cut))</span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/9393ff1cb19d12c3e2c6fb0907a8abec0266afd2/4506b/visualize_files/figure-html/unnamed-chunk-36-1.png" alt="img" style="zoom: 33%;" />  <img src="https://d33wubrfki0l68.cloudfront.net/7b810f000698f595cdf8155d0d0bdff3bbd1255e/dc244/visualize_files/figure-html/unnamed-chunk-36-2.png" alt="img" style="zoom: 25%;" /></p>
<h4 id="1、position参数的默认设置：stack-（堆叠）"><a href="#1、position参数的默认设置：stack-（堆叠）" class="headerlink" title="1、position参数的默认设置：stack （堆叠）"></a>1、position参数的默认设置：stack （堆叠）</h4><p>Note what happens if you map the <strong>fill</strong> aesthetic to another variable, like <u>clarity</u>: the bars are automatically <strong>stacked（堆叠）</strong>. Each colored rectangle（矩形） represents a combination of <u>cut</u> and <u>clarity</u>如下图.</p>
<img src="https://d33wubrfki0l68.cloudfront.net/b781966a14bd0a8d9569ba1bc32a66a7472ab1ad/506ac/visualize_files/figure-html/unnamed-chunk-37-1.png" alt="img" style="zoom: 50%;" />

<p>The stacking is performed automatically by the <strong>position adjustment</strong> specified by the position argument. （堆叠是通过position参数所指定的position adjustment自动执行的。）如果不想要堆叠，可以选择下面的几种position。</p>
<h4 id="2、position-“identity”"><a href="#2、position-“identity”" class="headerlink" title="2、position = “identity”"></a>2、position = “identity”</h4><p>可以将每个对象准确的放在图形context的位置。在bar charm中，需要通过  alpha 设置为较小值来提高透明度，或者通过  fill= NA 来使柱形完全透明。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) +</span><br><span class="line">  geom_bar(alpha = <span class="number">1</span>/<span class="number">5</span>, position = <span class="string">"identity"</span>)</span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/3a9772286d193f2dfec75877a51595c6e42c7b1e/5ef4a/visualize_files/figure-html/unnamed-chunk-38-1.png" alt="img" style="zoom:50%;" />

<p>适用：The <strong>identity</strong> <strong>position</strong> adjustment is more useful for <strong>2d geoms,</strong> like points, where it is the default.</p>
<h4 id="3、position-“fill”"><a href="#3、position-“fill”" class="headerlink" title="3、position = “fill”"></a>3、position = “fill”</h4><p>就像堆叠一样，但是使每组堆叠的柱形具有相同的高度。 这样可以更轻松地比较各组之间的比例。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, fill = clarity), position = <span class="string">"fill"</span>)</span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/bee92a133ce00474619d9988a9cffddefae7a1c5/015d7/visualize_files/figure-html/unnamed-chunk-39-1.png" alt="img" style="zoom:33%;" />

<h4 id="4、position-“dodge”"><a href="#4、position-“dodge”" class="headerlink" title="4、position = “dodge”"></a>4、position = “dodge”</h4><p>places overlapping（重叠堆叠） objects directly <em>beside</em> one another. This makes it easier to compare individual values.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) + </span><br><span class="line">  geom_bar(mapping = aes(x = cut, fill = clarity), position = <span class="string">"dodge"</span>)</span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/448fcff74e08a75c969cbeea6e120d9c5f3caf32/4c14e/visualize_files/figure-html/unnamed-chunk-40-1.png" alt="img" style="zoom:33%;" />

<h4 id="5、position-“jitter”-用于散点图"><a href="#5、position-“jitter”-用于散点图" class="headerlink" title="5、position = “jitter”  (用于散点图)"></a>5、position = “jitter”  (用于散点图)</h4><p>这个图的数据不用diamonds的了，用回最开始的mpg数据：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg) +</span><br><span class="line">  geom_point(mapping = aes(x = displ, y = hwy), position = <span class="string">"jitter"</span>)</span><br><span class="line"><span class="comment">#不用jitter也能看出hwy和displ的关系，但是用上jitter之后能够看清在那些地方的点更密集</span></span><br><span class="line"><span class="comment">#上面这段代码等价于下列代码：</span></span><br><span class="line">ggplot(data = mpg,mapping = aes(x = displ, y = hwy)) +   </span><br><span class="line">  geom_jitter()</span><br></pre></td></tr></table></figure>

<img src="https://d33wubrfki0l68.cloudfront.net/115fc4d17743511db8db3413083ca34e7b725398/5f210/visualize_files/figure-html/unnamed-chunk-42-1.png" alt="img" style="zoom:33%;" />

<p>You can avoid this gridding（网格化,即数据全在网格上，有大量重合的点） by setting the position adjustment to “jitter（抖动、跳动）”. <strong>position = “jitter”</strong> adds a small amount of <strong>random noise（随机噪声）</strong> to each point.  This spreads the points out because no two points are likely to receive the same amount of random noise.</p>
<blockquote>
<p>添加随机性使得图像在小scale上不太准确，但是会使得图像在大scale下更具启发性。所以ggplot2附带了   <strong>geom_point(position = “jitter”)</strong> 这一语句的简写    <strong>geom_jitter()</strong></p>
</blockquote>
<blockquote>
<p>To learn more about a position adjustment, look up the help page associated with each adjustment: <code>?position_dodge</code>, <code>?position_fill</code>, <code>?position_identity</code>, <code>?position_jitter</code>, and <code>?position_stack</code>.</p>
</blockquote>
<h4 id="习题-2"><a href="#习题-2" class="headerlink" title="习题"></a>习题</h4><p><strong>1、What parameters to <code>geom_jitter()</code> control the amount of jittering?</strong></p>
<p>查看  geom_jitter() 的帮助documentation, there are two arguments to jitter:</p>
<ul>
<li><code>width</code> controls the amount of horizontal displacement, and</li>
<li><code>height</code> controls the amount of vertical displacement.</li>
</ul>
<p>The defaults values of <code>width</code> and <code>height</code> will introduce noise in both directions. （默认情况下，自动向水平和垂直方向引入随即噪音。）  如果控制其中一个变量为0（width = 0 ），则只在另一个方向（垂直方向）进行抖动（随即噪音）。如果控制其中一个变量为20 （width = 20 ），则在该方向（水平方向）上抖动太剧烈了。</p>
<p><strong>2、Compare and contrast <code>geom_jitter()</code> with <code>geom_count()</code>.</strong></p>
<p> （1）<code>geom_jitter()</code> adds random variation（变异） to the locations points of the graph. In other words, it “jitters（抖动）” the locations of points slightly. 同位置的点大概率有不同的随机噪声，所以这个geom函数减少了重复绘制。但是减少重叠的代价是改变了点的坐标值x和y。（上一张图就是这函数的）</p>
<p>（2）<code>geom_count()</code> sizes（显示尺寸） the points relative to the number of observations. Combinations of (x, y) values with more observations will be larger than those with fewer observations.但是也有可能因为某些点数据过多造成size太大而重叠。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +  </span><br><span class="line">  geom_count()</span><br></pre></td></tr></table></figure>

<img src="R与数据分析.assets/image-20200723224824685.png" alt="image-20200723224824685" style="zoom: 50%;" />

<h2 id="七、坐标系（Coordinate-systems）"><a href="#七、坐标系（Coordinate-systems）" class="headerlink" title="七、坐标系（Coordinate systems）"></a>七、坐标系（Coordinate systems）</h2><h3 id="1、默认坐标系——笛卡尔坐标"><a href="#1、默认坐标系——笛卡尔坐标" class="headerlink" title="1、默认坐标系——笛卡尔坐标"></a>1、默认坐标系——笛卡尔坐标</h3><p>Coordinate systems are probably the most complicated part of ggplot2. The default coordinate system is the <strong>Cartesian coordinate system</strong> where the x and y positions act independently to determine the location of each point. </p>
<p>There are a number of other coordinate systems that are occasionally helpful.</p>
<h3 id="2、coord-flip-切换横纵轴"><a href="#2、coord-flip-切换横纵轴" class="headerlink" title="2、coord_flip()  切换横纵轴"></a>2、coord_flip()  切换横纵轴</h3><p>在两种情况下适用：（1）想要横置图像；（2）横轴上变量名太长产生重叠，横过来放就行了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; mpg, mapping &#x3D; aes(x &#x3D; class, y &#x3D; hwy)) +</span><br><span class="line">  geom_boxplot() + </span><br><span class="line">  coord_flip()</span><br></pre></td></tr></table></figure>

<p><img src="https://d33wubrfki0l68.cloudfront.net/e30eac02f2c9749b8a46dcf6fa893353b7e30d21/24b34/visualize_files/figure-html/unnamed-chunk-44-2.png" alt="img"></p>
<h3 id="3、coord-quickmap-正确设置地图的纵横比"><a href="#3、coord-quickmap-正确设置地图的纵横比" class="headerlink" title="3、coord_quickmap()  正确设置地图的纵横比"></a>3、coord_quickmap()  正确设置地图的纵横比</h3><p>sets the aspect ratio correctly for maps. This is very important if you’re plotting spatial data（空间数据） with ggplot2 (这本书不讲).</p>
<p>和geom函数并排写上  coord_quickmap()  就行。图略</p>
<h3 id="4、coord-polar-极坐标"><a href="#4、coord-polar-极坐标" class="headerlink" title="4、coord_polar()  极坐标"></a>4、coord_polar()  极坐标</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +</span><br><span class="line">  geom_bar(mapping = aes(x = cut, fill = cut),show.legend = <span class="literal">FALSE</span>,width = <span class="number">1</span>) + </span><br><span class="line">  labs(x =<span class="string">"实验作图"</span>, y = <span class="literal">NULL</span>)+</span><br><span class="line">  coord_polar()</span><br><span class="line">  </span><br><span class="line"> <span class="comment">#width = 1 是必须的，才能使每部分图紧挨着，否则有缝隙</span></span><br></pre></td></tr></table></figure>

<p><img src="R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90.assets/image-20200723231420400.png" alt="image-20200723231420400"></p>
<p>coord_polar（）函数的第一个参数  theta  可以等于x或y（等号后要加引号！），默认为”x”，即用x轴来画angle。这时是极坐标图（上图）。如果用coord_polar（”y”）绘图则会化成类似同心圆的样子。</p>
<h3 id="习题-3"><a href="#习题-3" class="headerlink" title="习题"></a>习题</h3><h4 id="1、画出饼图"><a href="#1、画出饼图" class="headerlink" title="1、画出饼图"></a>1、画出<strong>饼图</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; diamonds) +  </span><br><span class="line">  geom_bar(mapping &#x3D; aes(x &#x3D; cut, fill &#x3D;clarity),width &#x3D; 1, position &#x3D; &quot;fill&quot;) + </span><br><span class="line">  coord_polar()</span><br><span class="line"> #如下图，先用position &#x3D; &quot;fill&quot;把柱状bar图化成同高度的图，再转换坐标</span><br></pre></td></tr></table></figure>

<p><img src="R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90.assets/image-20200723232730207.png" alt="image-20200723232730207"></p>
<p>如果想画成同心圆，就改变theta参数：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = diamonds) +   </span><br><span class="line">  geom_bar(mapping = aes(x = cut, fill =clarity),width = <span class="number">1</span>, position = <span class="string">"fill"</span>) + </span><br><span class="line">  coord_polar(theta = <span class="string">"y"</span>)</span><br><span class="line"> <span class="comment">#theta是第一个参数，所以可以只写coord_polar("y")也行</span></span><br></pre></td></tr></table></figure>

<p><img src="R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90.assets/image-20200723233107908.png" alt="image-20200723233107908"></p>
<h4 id="2、标签函数-What-does-labs-do-Read-the-documentation"><a href="#2、标签函数-What-does-labs-do-Read-the-documentation" class="headerlink" title="2、标签函数 What does labs() do? Read the documentation."></a>2、标签函数 What does labs() do? Read the documentation.</h4><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = mpg, mapping = aes(x = class, y = hwy)) +  </span><br><span class="line">  geom_boxplot() +  </span><br><span class="line">  coord_flip() +  </span><br><span class="line">  labs(y = <span class="string">"Highway MPG"</span>,</span><br><span class="line">       x = <span class="string">"Class"</span>,title = <span class="string">"Highway MPG by car class"</span>,     </span><br><span class="line">       subtitle = <span class="string">"1999-2008"</span>,      </span><br><span class="line">       caption = <span class="string">"Source: http://fueleconomy.gov"</span>)</span><br></pre></td></tr></table></figure>

<img src="https://jrnold.github.io/r4ds-exercise-solutions/visualize_files/figure-html/unnamed-chunk-70-1.png" alt="img" style="zoom:33%;" />

<p>The labs() function is not the only function that adds titles to plots. The <strong>xlab()</strong>, <strong>ylab()</strong>, and x- and y-scale functions can add axis titles. The <strong>ggtitle()</strong> function adds plot titles.</p>
<p>3、What’s the difference between coord_quickmap() and coord_map()?</p>
<p>The coord_map() function uses map projections to project the three-dimensional Earth onto a two-dimensional plane. By default, coord_map() uses the Mercator projection. This projection is applied to all the geoms in the plot. The coord_quickmap() function uses an approximate but faster map projection. This approximation ignores the curvature of Earth and adjusts the map for the latitude/longitude ratio. The coord_quickmap() project is faster than coord_map() both because the projection is computationally easier, and unlike coord_map(), the coordinates of the individual geoms do not need to be transformed.</p>
<p>4、What does the plot below tell you about the relationship between city and highway mpg? Why is <code>coord_fixed()</code> important? What does <code>geom_abline()</code> do?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data &#x3D; mpg, mapping &#x3D; aes(x &#x3D; cty, y &#x3D; hwy)) + </span><br><span class="line">  geom_point() +   </span><br><span class="line">  geom_abline() +  </span><br><span class="line">  coord_fixed()</span><br></pre></td></tr></table></figure>

<p>答案：The function <strong>coord_fixed()</strong> ensures that the line produced by <strong>geom_abline()</strong> is at a <strong>45-degree angle</strong>. A 45-degree line makes it easy to compare the highway and city mileage to the case in which city and highway MPG were equal.</p>
<h2 id="八、图层语法The-layered-grammar-of-graphics"><a href="#八、图层语法The-layered-grammar-of-graphics" class="headerlink" title="八、图层语法The layered grammar of graphics"></a>八、图层语法The layered grammar of graphics</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot(data = &lt;DATA&gt;) + </span><br><span class="line">  &lt;GEOM_FUNCTION&gt;(mapping = aes(&lt;MAPPINGS&gt;), </span><br><span class="line">                  stat = &lt;STAT&gt;,      </span><br><span class="line">                  position = &lt;POSITION&gt;) +      </span><br><span class="line">  &lt;COORDINATE_FUNCTION&gt; + </span><br><span class="line">  &lt;FACET_FUNCTION&gt;</span><br></pre></td></tr></table></figure>

<p>图层主要包括上述模板的部分，构造图层的原理要从数据表讲起，略。</p>
<h1 id="第二章-Data-transformation"><a href="#第二章-Data-transformation" class="headerlink" title="第二章 Data transformation"></a>第二章 Data transformation</h1><h2 id="一、Introduction"><a href="#一、Introduction" class="headerlink" title="一、Introduction"></a>一、Introduction</h2><p>可视化能方便我们进行洞察，但是我们的数据形式并不总是满足可视化的需要。所以要对数据进行处理。</p>
<p>本节使用 <strong>dplyr</strong> 包 这一数据处理工具 和 <code>nycflights13::flights</code>这一数据源。使用  tidyverse包时，其中的dplyr包会将stats包的filter和lag函数冲突掉，如果想要使用被冲突的函数则需全写<code>stats::filter()</code> 和<code>stats::lag()</code>。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(nycflights13) </span><br><span class="line"><span class="keyword">library</span>(tidyverse)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该数据框包含2013年从纽约市出发的所有336,776个航班。该数据来自美国运输统计局，并在飞行中进行了记录。</p>
<p>直接输入fights看到的数据详情只显示有限列（恰好适应屏幕），这不同于其他数据框（如mpg如果屏幕窄也会显示全部列但是会缩写表中的内容）（当然用view（）函数打开数据查看器后就没区别了），因为fights数据是<strong>tibble</strong>，这个tibble将在wrangle里学习。</p>
</blockquote>
<p>常见变量类型：</p>
<table>
<thead>
<tr>
<th>type of variable</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>int</td>
<td>stand for integers  代表整数</td>
</tr>
<tr>
<td>dbl</td>
<td>stands for doubles，or real numbers 代表双精度浮点数或实数。</td>
</tr>
<tr>
<td>chr</td>
<td>stands for character vectors, or strings.代表字符向量或字符串。</td>
</tr>
<tr>
<td>dttm</td>
<td>stands for date-times (a date + a time).（日期+时间）</td>
</tr>
<tr>
<td>lgl</td>
<td>stands for logical, vectors that contain only TRUE or FALSE.</td>
</tr>
<tr>
<td>fctr</td>
<td>stands for factors, which R uses to represent categorical variables with fixed possible values.（因子：用来表示具有固定可能值的分类变量）</td>
</tr>
<tr>
<td>date</td>
<td>stands for dates.（代表日期）</td>
</tr>
</tbody></table>
<p>本章学习五个基本的dplyr函数，这将使我们能够处理绝大多数数据操作：</p>
<p>Pick observations by their values (<strong>filter()</strong>).按其值拾取观测值<br>        Reorder the rows (<strong>arrange()</strong>).重新排序行<br>        Pick variables by their names (<strong>select()</strong>).按名称拾取变量<br>        Create new variables with functions of existing variables (<strong>mutate()</strong>).使用现有变量的函数创建新变量<br>        Collapse many values down to a single summary (<strong>summarise()</strong>).将多个值折叠为单个摘要</p>
<p>这五个函数都可以与  <strong>group_by()</strong>  结合使用，后者将每个函数的作用域从操作整个数据集(entire dataset）更改为逐个组操作（group-by-group）。 这六个函数可以看作为数据操作（data manipulation）的language提供了<strong>verbs</strong>。</p>
<p>上述所有函数的工作方式都相似：</p>
<p><strong>第一个参数</strong>是<strong>数据框</strong>。（The first argument is a <strong>data frame</strong>.）</p>
<p><strong>后续参数</strong>使用变量名(不带引号)描述<strong>如何处理数据框</strong>。The subsequent arguments describe <strong>what to do</strong> with the data frame, using the variable names (without quotes).</p>
<p><strong>结果</strong>是一个<strong>新的数据框</strong>。The result is a <strong>new data frame</strong>.</p>
<blockquote>
<p>承上启下：Together these properties make it easy to chain together multiple simple steps to achieve a complex result. Let’s dive in（投入其中） and see how these verbs work.</p>
</blockquote>
<h2 id="二、用filter（）筛选行"><a href="#二、用filter（）筛选行" class="headerlink" title="二、用filter（）筛选行"></a>二、用filter（）筛选行</h2><p><strong>filter（）</strong>允许您根据观测值将其子集化（subset observations based on their values）。 第一个参数是<strong>数据框的名称</strong>。 第二个和后续（subsequent）参数是用于<strong>过滤数据帧的表达式</strong>（the expressions that filter the data frame）。 例如，我们可以选择1月1日的所有航班（注意：此处用连等号==作为逻辑运算符，单个=会被视作赋值运算符）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, month == <span class="number">1</span>, day == <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>输入这行代码将直接再屏幕上输出结果（一个新的数据框），但是不做保存（<strong>dplyr绝对不会修改其输入</strong>）。如果想要保存结果，就要用到<strong>赋值运算符</strong>( assignment operator)     <code>&lt;-</code>   如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jan1 &lt;- filter(flights, month == <span class="number">1</span>, day == <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>·R either（要么） <strong>prints out the results</strong>, or（要么） <strong>saves them to a variable</strong>. If you want to do both, you can wrap（裹起来） the assignment in parentheses（括号）:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(dec25 &lt;- filter(flights, month == <span class="number">12</span>, day == <span class="number">25</span>))</span><br></pre></td></tr></table></figure>

<h3 id="1、比较运算符（comparisons-operator）"><a href="#1、比较运算符（comparisons-operator）" class="headerlink" title="1、比较运算符（comparisons operator）"></a>1、比较运算符（comparisons operator）</h3><p>To use filtering effectively, you have to know how to select the observations that you want using the <strong>comparison operators（比较运算符）</strong>. R provides the standard suite（标准套件）: &gt;, &gt;=, &lt;, &lt;=, != (not equal), and == (equal).</p>
<blockquote>
<p>易错点 1 ：将 == 用成 = 会导致报错，这是比较和赋值的差别。</p>
<p>易错点 2 ：比较浮点型（float）数值时，不能用 == 符号，因为浮点型数值的运算过程中可能产生无理数，而计算机会根据单精度或双精度浮点精确到32或64位字节（例如 根号2，是以1.414…的小数形式存在计算机里的）。这时可以用函数  <code>near(A,B)</code>来比较A和B的大小，其中A就可以是浮点数</p>
</blockquote>
<p><img src="R%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90.assets/image-20200725211409429.png" alt="image-20200725211409429"></p>
<h3 id="2、逻辑运算符（logical-operator）"><a href="#2、逻辑运算符（logical-operator）" class="headerlink" title="2、逻辑运算符（logical operator）"></a>2、逻辑运算符（logical operator）</h3><p>Multiple arguments（多个参数） to filter() are combined with <strong>“and”</strong>: every expression（表达式） must be <strong>true</strong> in order for <u>a row to be included in the output</u>. For other types of combinations（组合）, you’ll need to use Boolean operators（布尔运算符） yourself: <u>&amp; is “and”, | is “or”, ! is “not”</u>. 下面图展示了完整的布尔运算集（ x是左侧圆圈，y是右侧圆圈，阴影区域显示每个运算选择哪些部分）：</p>
<img src="https://d33wubrfki0l68.cloudfront.net/01f4b6d39d2be8269740a3ad7946faa79f7243cf/8369a/diagrams/transform-logical.png" alt="Complete set of boolean operations. `x` is the left-hand circle, `y` is the right-hand circle, and the shaded region show which parts each operator selects." style="zoom:80%;" />

<p>以下代码查找11月或12月出发（departed）的所有航班：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, month == <span class="number">11</span> | month == <span class="number">12</span>)</span><br></pre></td></tr></table></figure>

<p>这个顺序不能变，如果写成：  <code>filter(flights, month == (11 | 12))</code>   那么它将筛选month值为”（11| 12）”的航班数据，即 TRUE 月份的数据，在纯数字语境下TRUE即为 1 ，所以结果是 1 月份的数据。</p>
<p>解决此问题的捷径是        <code>x％in％y</code>      这将选择所有符合“x是y中的值之一”的每一行。 我们可以用它来重写上面的代码：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nov_dec &lt;- filter(flights, month %<span class="keyword">in</span>% c(<span class="number">11</span>, <span class="number">12</span>))</span><br></pre></td></tr></table></figure>

<p>Sometimes you can <u>simplify complicated subsetting（简化复杂的子集）</u> by remembering <strong>De Morgan’s law</strong>: </p>
<p>​     !(x &amp; y)    is the same as       !x | !y      </p>
<p>​     !(x | y)    is the same as     !x &amp; !y</p>
<p>例如，要查找未延迟（到达或离开）两个小时以上的航班，则可以使用以下两个过滤器之一：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, !(arr_delay &gt; <span class="number">120</span> | dep_delay &gt; <span class="number">120</span>)) </span><br><span class="line"><span class="comment">#这两个filter等效</span></span><br><span class="line">filter(flights, arr_delay &lt;= <span class="number">120</span>, dep_delay &lt;= <span class="number">120</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>As well as   &amp;   and   |   , R also has    &amp;&amp;   and   ||  . Don’t use them here! You’ll learn when you should use them in conditional execution(在第十九章，program的function部分学习）.</p>
<p>每当您在filter（）中开始使用<strong>复杂的多部分表达式（complicated, multipart expressions）</strong>时，请考虑改为使它们成为<strong>显式变量（explicit variables）</strong>。 这样可以更轻松地检查您的工作。 您将很快学习如何创建新变量。</p>
</blockquote>
<h3 id="3、缺失值（-Missing-values）"><a href="#3、缺失值（-Missing-values）" class="headerlink" title="3、缺失值（ Missing values）"></a>3、缺失值（ Missing values）</h3><p>R的一个很重要的特征可能使comparison（比较）变得棘手，即<strong>缺失值</strong>【写作   <code>NA</code>】（”not availables”）。  NA代表未知值，因此缺失值具有“传染性（contagious）”：几乎所有涉及未知值的操作也将是未知的。</p>
<p>如果要确定一个值是否为缺失值，使用代码  <code>is.na()</code></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- <span class="literal">NA</span></span><br><span class="line">is.na(x) </span><br><span class="line"><span class="comment">#  [1] TRUE </span></span><br><span class="line">y &lt;- <span class="number">666</span> </span><br><span class="line">is.na(y) </span><br><span class="line"><span class="comment">#  [1] FALSE</span></span><br></pre></td></tr></table></figure>

<p>filter（）仅包含状态（condition）为 TRUE 的行； 它不包括FALSE和NA值。 如果要保留缺失值，请明确要求它们：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df &lt;- tibble(x = c(<span class="number">1</span>, <span class="literal">NA</span>, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">filter(df, x &gt; <span class="number">1</span>)</span><br><span class="line"><span class="comment">#这将只显示一行，值为3</span></span><br><span class="line"></span><br><span class="line">filter(df, is.na(x) | x &gt; <span class="number">1</span>)</span><br><span class="line"><span class="comment">#这将显示两行：NA和3</span></span><br></pre></td></tr></table></figure>

<h3 id="4、Exercises"><a href="#4、Exercises" class="headerlink" title="4、Exercises"></a>4、Exercises</h3><p>一、Find all flights that ： </p>
<p>1、Had an arrival delay of two or more hours </p>
<p>2、Flew to Houston (IAH or HOU) </p>
<p>3、Were operated by United, American, or Delta </p>
<p>4、Departed in summer (July, August, and September) </p>
<p>5、Arrived more than two hours late, but didn’t leave late </p>
<p>6、Were delayed by at least an hour, but made up over 30 minutes in flight </p>
<p>7、Departed between midnight and 6am (inclusive)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(<span class="string">"nycflights13"</span>) </span><br><span class="line"><span class="keyword">library</span>(<span class="string">"tidyverse"</span>)</span><br><span class="line"></span><br><span class="line">t1 &lt;- filter(flights, arr_delay &gt;= <span class="number">120</span>)</span><br><span class="line"></span><br><span class="line">t2 &lt;- filter(flights,dest %<span class="keyword">in</span>% c(<span class="string">"IAH"</span>,<span class="string">"HOU"</span>))</span><br><span class="line">t22 &lt;- filter(flights, dest == <span class="string">"IAH"</span> | dest == <span class="string">"HOU"</span>)</span><br><span class="line"><span class="comment">#用 %in% 更紧凑，且能扩展到检索多个机场的情况</span></span><br><span class="line"><span class="comment">#可用all.equal(t2,t22)来验证这俩数据框相等</span></span><br><span class="line"></span><br><span class="line">t3 &lt;- filter(flights,carrier %<span class="keyword">in</span>% c(<span class="string">"DL"</span>,<span class="string">"UA"</span>,<span class="string">"AA"</span>))</span><br><span class="line"><span class="comment">#输入airlines即可罗列出carrier里所有简写的含义</span></span><br><span class="line"></span><br><span class="line">t4 &lt;- filter(flights,month %<span class="keyword">in</span>% c(<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>))</span><br><span class="line">t44 &lt;- filter(flights, month %<span class="keyword">in</span>% <span class="number">7</span>:<span class="number">9</span>)   <span class="comment">#用：指定整数范围</span></span><br><span class="line">t444 &lt;- filter(flights, month &gt;= <span class="number">7</span>, month &lt;= <span class="number">9</span>)    <span class="comment">#略麻烦</span></span><br><span class="line"><span class="comment">#我们还可以使用下一道大题中所示的between（）函数</span></span><br><span class="line"></span><br><span class="line">t5 &lt;- filter(flights,dep_delay &lt;= <span class="number">0</span> , arr_delay &gt; <span class="number">120</span>) </span><br><span class="line"></span><br><span class="line">t6 &lt;- filter(flights,dep_delay &gt;= <span class="number">60</span> , dep_delay - arr_delay &gt;<span class="number">30</span> )</span><br><span class="line"><span class="comment">#搞清楚起飞延迟和降落延迟都是基于“实际时点 - 计划时点”计算出来</span></span><br><span class="line"></span><br><span class="line">t7  &lt;- filter(flights, dep_time &lt;= <span class="number">600</span> | dep_time == <span class="number">2400</span>)</span><br><span class="line"><span class="comment">##先用summary（）查验最大最小值，发现最大值2400（即midnight时分为2400，所以在（0，600）之外额外加上2400的情况才行。NA值不管。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>1、观测值为<strong>字符型</strong>变量时，一定要记得加<strong>双引号</strong>！！！（t2）</p>
<p>2、数据筛选前，先用<strong>summary（）</strong>看一下<strong>摘要</strong>！！！（t7）</p>
<p>3、第七小问其他方法：</p>
<p>我们可以使用模运算符  %%     模运算符返回除法的余数。 </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c(<span class="number">600</span>, <span class="number">1200</span>,<span class="number">1400</span> ,<span class="number">1500</span>,<span class="number">1800</span>,<span class="number">2400</span>) %% <span class="number">2400</span> </span><br><span class="line">[<span class="number">1</span>]  <span class="number">600</span> <span class="number">1200</span> <span class="number">1400</span> <span class="number">1500</span> <span class="number">1800</span>    <span class="number">0</span>     <span class="comment">#这行是结果</span></span><br></pre></td></tr></table></figure>

<p>可以看到除了2400，其他都不变！所以我们可以拿余数去和600比较，来解题：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, dep_time %% <span class="number">2400</span> &lt;= <span class="number">600</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>2、Another useful dplyr filtering helper（筛选助手） is <strong>between()</strong>. What does it do? Can you use it to simplify the code needed to answer the previous challenges?</p>
<p>表达式 between(x, left, right) 就等于 x &gt;= left &amp; x &lt;= right   这一式子，<br> 对于上个问题的第4小问，可以简化如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t4 &lt;- filter(flights, between(month, <span class="number">7</span>, <span class="number">9</span>))</span><br></pre></td></tr></table></figure>



<p>3、How many flights have a missing <code>dep_time</code>? What other variables are missing? What might these rows represent?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, is.na(dep_time))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>值得注意的是，这些行的到达时间（arr_time）也丢失了。 这些似乎已取消航班。</p>
</blockquote>
<p>函数summary（）的输出包括所有非字符变量的缺失值数量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">summary(flights)</span><br></pre></td></tr></table></figure>



<p>4、Why is NA ^ 0 not missing? Why is NA | TRUE not missing? Why is FALSE &amp; NA not missing? Can you figure out the general rule? (NA * 0 is a tricky counterexample!)</p>
<p><code>NA ^ 0 == 1</code> since for all numeric values $x^0=1$ </p>
<p><code>NA | TRUE</code> is <code>TRUE</code> because anything <strong>or</strong> <code>TRUE</code> is <code>TRUE</code>. If the missing value were <code>TRUE</code>, then <code>TRUE | TRUE == TRUE</code>, and if the missing value was <code>FALSE</code>, then <code>FALSE | TRUE == TRUE</code>.</p>
<p>The value of <code>NA &amp; FALSE</code> is <code>FALSE</code> because anything <strong>and</strong> <code>FALSE</code> is always <code>FALSE</code>. If the missing value were <code>TRUE</code>, then <code>TRUE &amp; FALSE == FALSE</code>, and if the missing value was <code>FALSE</code>, then <code>FALSE &amp; FALSE == FALSE</code>.</p>
<p>For <code>NA | FALSE</code>, the value is unknown since <code>TRUE | FALSE == TRUE</code>, but <code>FALSE | FALSE == FALSE</code>.</p>
<p>For <code>NA &amp; TRUE</code>, the value is unknown since <code>FALSE &amp; TRUE== FALSE</code>, but <code>TRUE &amp; TRUE == TRUE</code>.</p>
<p>Since x∗0=0x∗0=0 for all finite numbers we might expect <code>NA * 0 == 0</code>, but that’s not the case. The reason that <code>NA * 0 != 0</code> is that 0×∞0×∞ and 0×−∞0×−∞ are undefined. R represents undefined results as <code>NaN</code>, which is an abbreviation of “<a href="https://en.wikipedia.org/wiki/NaN" target="_blank" rel="noopener">not a number</a>”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Inf * 0</span><br><span class="line">#&gt; [1] NaN</span><br><span class="line">-Inf * 0</span><br><span class="line">#&gt; [1] NaN</span><br></pre></td></tr></table></figure>

<h2 id="三、重新排序行Arrange-rows-with-arrange"><a href="#三、重新排序行Arrange-rows-with-arrange" class="headerlink" title="三、重新排序行Arrange rows with arrange()"></a>三、重新排序行Arrange rows with <code>arrange()</code></h2><p>ranging（）与filter（）的工作原理类似，但是它不选择行，而是更改行的顺序。 它需要一个数据框和一组列名（或更复杂的表达式）进行排序。 如果提供多个列名，则每增加一列将用于打破前面各列的值的联系：使用arrange（）就是默认按照<strong>升序</strong>排序</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, year, month, day)</span><br><span class="line"><span class="comment">#arrange（数据框名，列名1，列名2，列名3）</span></span><br></pre></td></tr></table></figure>

<p>使用 <strong>desc()</strong> 来 re-order by a column in descending order（按列的<strong>降序</strong>重新排序）</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, desc(dep_delay))</span><br></pre></td></tr></table></figure>

<p>缺失值（Missing values）总是排在末尾（sorted at the end）。</p>
<h3 id="习题-4"><a href="#习题-4" class="headerlink" title="习题"></a>习题</h3><p>1、How could you use arrange() to sort all missing values to the start? (Hint: use is.na()).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过下面这句配合tail（）函数来显示最后几行数据，tail与head相对，是输出最后（或最前）几行数据</span></span><br><span class="line">arrange(flights, dep_time)  %&gt;%   tail()</span><br></pre></td></tr></table></figure>

<p>使用  <code>arrange(flights, desc(dep_time))</code>   不能让NA提前。</p>
<p>但是如果我们在desc（）中先添加一个指示符就行了：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, desc(is.na(dep_time)), dep_time)</span><br><span class="line"><span class="comment">#原理：排期将首先按desc（is.na（dep_time））排序。 在dep_time为缺失值时，desc（is.na（dep_time））为TRUE（否则为FALSE）。由于TRUE&gt; FALSE，dep_time列的缺失值的行将排在前面。</span></span><br></pre></td></tr></table></figure>



<p>2、Sort flights to find the most delayed flights. Find the flights that left earliest（哪个航班的延迟最小，可为负值）.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, desc(dep_delay))</span><br><span class="line"></span><br><span class="line">arrange(flights, dep_delay)</span><br></pre></td></tr></table></figure>



<p>3、Sort flights to find the fastest (highest speed) flights.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head(arrange(flights, desc(distance / air_time)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>还可以创造一个新的变量——用后续章节的<strong>mutate()</strong>函数进行</p>
</blockquote>
<p>4、Which flights travelled the farthest? Which travelled the shortest?</p>
<h2 id="四、使用select（）选择columns列"><a href="#四、使用select（）选择columns列" class="headerlink" title="四、使用select（）选择columns列"></a>四、使用select（）选择columns列</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Select columns by name 挑选出年月日三个列 </span></span><br><span class="line">select(flights, year, month, day)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Select all columns between year and day (inclusive)从year到day的列都选中</span></span><br><span class="line">select(flights, year:day)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反选 Select all columns except those from year to day (inclusive)  反选</span></span><br><span class="line">select(flights, -(year:day))</span><br></pre></td></tr></table></figure>

<p>在select（）中可以使用许多辅助函数：</p>
<p><code>starts_with(&quot;abc&quot;)</code>  :开头字符matches names that begin with “abc”.</p>
<p><code>ends_with(&quot;xyz&quot;)</code>  : 结尾字符matches names that end with “xyz”.</p>
<p><code>contains(&quot;ijk&quot;)</code>  : 包含该字符串matches names that contain “ijk”.</p>
<p><code>matches(&quot;(.)\\1&quot;)</code>  : 正则selects variables that match a <u>regular expression（正则表达式）</u>. This one matches any variables that contain repeated characters. （在14章string 学习正则表达式）</p>
<p><code>num_range(&quot;x&quot;, 1:3)</code>  : matches x1, x2 and x3.</p>
<blockquote>
<p>其他的看?select的帮助</p>
</blockquote>
<p>select()还有一个用法是与 everything() 结合起来，使特定<strong>列左移</strong>，即将几个变量移到数据框的左边开头。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select(flights, time_hour, air_time, everything())</span><br><span class="line"><span class="comment">#把这两个变量移到了最左边的两列</span></span><br></pre></td></tr></table></figure>

<p>另外，select（）可以用于重命名变量，但是它很少有用，因为它会删除所有未明确提及的变量。 相反，请使用rename（），这是select（）的变体，其中保留了所有未明确提及的变量：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename(flights, tail_num = tailnum)</span><br></pre></td></tr></table></figure>

<h3 id="习题-5"><a href="#习题-5" class="headerlink" title="习题"></a>习题</h3><p>1、Brainstorm as many ways as possible to select dep_time, dep_delay, arr_time, and arr_delay from flights.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">t11 &lt;- select(flights,dep_time,dep_delay,arr_time,arr_delay)</span><br><span class="line"><span class="comment">#将列名称指定为未加引号的变量名称（unquoted variable names）。</span></span><br><span class="line"></span><br><span class="line">select(flights, <span class="string">"dep_time"</span>, <span class="string">"dep_delay"</span>, <span class="string">"arr_time"</span>, <span class="string">"arr_delay"</span>)</span><br><span class="line"><span class="comment">#将列名称指定为字符串。</span></span><br><span class="line"></span><br><span class="line">select(flights, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>)</span><br><span class="line"><span class="comment">#指定变量的列号。但不好，因为容易混淆代码，且更改列位置后可运行但答案已经错误</span></span><br><span class="line"></span><br><span class="line">select(flights, all_of(c(<span class="string">"dep_time"</span>, <span class="string">"dep_delay"</span>, <span class="string">"arr_time"</span>, <span class="string">"arr_delay"</span>)))</span><br><span class="line">select(flights, any_of(c(<span class="string">"dep_time"</span>, <span class="string">"dep_delay"</span>, <span class="string">"arr_time"</span>, <span class="string">"arr_delay"</span>)))</span><br><span class="line"><span class="comment">#使用字符向量和any_of（）或all_of（）指定变量的名称</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">variables &lt;- c(<span class="string">"dep_time"</span>, <span class="string">"dep_delay"</span>, <span class="string">"arr_time"</span>, <span class="string">"arr_delay"</span>) </span><br><span class="line">select(flights, all_of(variables))</span><br><span class="line"><span class="comment">#这很有用，因为可以将变量的名称存储在变量中并传递给all_of（）或any_of（）（注：这两个函数替换了已弃用的函数one_of（））</span></span><br><span class="line"></span><br><span class="line">select(flights, starts_with(<span class="string">"dep_"</span>), starts_with(<span class="string">"arr_"</span>))</span><br><span class="line"><span class="comment">#通过使用starts_with（）匹配变量名称的开头来选择变量。</span></span><br><span class="line"></span><br><span class="line">select(flights, matches(<span class="string">"^(dep|arr)_(time|delay)$"</span>))</span><br><span class="line"><span class="comment">#使用带有matchs（）的正则表达式选择变量。 </span></span><br><span class="line"></span><br><span class="line">variables &lt;- c(<span class="string">"dep_time"</span>, <span class="string">"dep_delay"</span>, <span class="string">"arr_time"</span>, <span class="string">"arr_delay"</span>)</span><br><span class="line">select(flights, !!variables)</span><br><span class="line"><span class="comment">#使用字符向量指定变量的名称，然后使用bang-bang运算符（!!）。</span></span><br><span class="line"><span class="comment">#此答案和以下答案使用整齐评估的功能，R4DS中未涵盖但在programming with dplyr短文中涵盖。https://dplyr.tidyverse.org/articles/programming.html</span></span><br><span class="line"></span><br><span class="line">variables &lt;- c(<span class="string">"dep_time"</span>, <span class="string">"dep_delay"</span>, <span class="string">"arr_time"</span>, <span class="string">"arr_delay"</span>) </span><br><span class="line">select(flights, !!!variables)</span><br><span class="line"><span class="comment">#在字符或列表向量中指定变量的名称，然后使用bang-bang-bang运算符。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用ends_with（）或者contains（）函数选取目标列名的关键词时，无法做到针对性选取，所以不能用。</p>
</blockquote>
<p>2、What happens if you include the name of a variable multiple times in a select() call?</p>
<p>回答：忽略重复变量，只在第一次出现的位置起作用。</p>
<p>注意：这意味着同时使用select（）和everything（）时候，不会产生重复，可以从容更改列的顺序。</p>
<p>3、What does the <strong>one_of()</strong> function do? Why might it be helpful in conjunction with this vector?</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vars &lt;- c(<span class="string">"year"</span>, <span class="string">"month"</span>, <span class="string">"day"</span>, <span class="string">"dep_delay"</span>, <span class="string">"arr_delay"</span>) <span class="comment">#题目给出此行</span></span><br></pre></td></tr></table></figure>

<p>one_of（）函数选择带有字符向量的变量，而不是未引用变量名的参数。 此函数很有用，因为以编程方式生成带有变量名的字符向量比生成未加引号的变量名更容易，后者更易于键入。</p>
<p>在dplyr的最新版本中，不赞成使用one_of，而推荐使用以下两个函数：all_of（）和any_of（）。 如果所有变量都存在于数据框中，则这些函数的行为类似。【这俩函数的严格性有所不同。 如果变量名之一不存在，函数all_of（）将引发错误，而any_of（）将忽略它。】</p>
<h2 id="五、使用mutate（）添加新的变量"><a href="#五、使用mutate（）添加新的变量" class="headerlink" title="五、使用mutate（）添加新的变量"></a>五、使用mutate（）添加新的变量</h2><p>mutate（）的作用：在数据集的末尾<strong>添加新列</strong>。  </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">flights_sml &lt;- select(flights,  year:day, ends_with(<span class="string">"delay"</span>),</span><br><span class="line">                       distance,  air_time ) </span><br><span class="line">mutate(flights_sml,</span><br><span class="line">       gain = dep_delay - arr_delay, </span><br><span class="line">       speed = distance / air_time * <span class="number">60</span> ) </span><br><span class="line"></span><br><span class="line"><span class="comment">#这是结果，只看列名即可：&gt; # A tibble: 336,776 x 9 </span></span><br><span class="line"><span class="comment">#&gt; year month day dep_delay arr_delay distance air_time  gain speed </span></span><br><span class="line"><span class="comment">#&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; #&gt; 1  2013     1     1         2        11     1400      227    -9  370.</span></span><br><span class="line"><span class="comment">#&gt; # … with 336,770 more rows</span></span><br></pre></td></tr></table></figure>

<p>注1：可以在创建新变量时使用逗号前面<strong>刚创建的变量</strong>。</p>
<p>注2：如果只想<strong>保留新增的变量</strong>，就使用  <code>transmute（）</code>函数</p>
<h3 id="可在mutate（）中使用的函数"><a href="#可在mutate（）中使用的函数" class="headerlink" title="可在mutate（）中使用的函数"></a>可在mutate（）中使用的函数</h3><p>有许多函数可以创建可与mutate（）一起使用的新变量。 关键属性是必须对函数进行<strong>向量化</strong>：它必须<strong>将值的向量作为输入</strong>，并<strong>返回与值的数目相同的向量</strong>。 （1</p>
<h4 id="（1）算数运算符（Arithmetic-operator）"><a href="#（1）算数运算符（Arithmetic-operator）" class="headerlink" title="（1）算数运算符（Arithmetic operator）"></a>（1）算数运算符（Arithmetic operator）</h4><p>包括  +   -   *   /   ^   即加减乘除乘方，这些都是使用所谓的“回收规则（recycling rules）”矢量化（vectorised）的。 如果一个参数比另一个短，它将自动扩展为相同的长度。算术运算符还可以与稍后学的聚合（aggregate）函数结合使用（即sum（）、mean（）直接进入运算。</p>
<h4 id="（2）模运算（Modular-arithmetic）"><a href="#（2）模运算（Modular-arithmetic）" class="headerlink" title="（2）模运算（Modular arithmetic）"></a>（2）模运算（Modular arithmetic）</h4><p>% / %   此符号为<strong>整除</strong>（integer division）</p>
<p>%%   此符号为<strong>取余</strong>（remainder）</p>
<blockquote>
<p>x == y * (x %/% y) + (x %% y)            #右式第一项为y乘以（x中包含几个完整的y，即整除），第二项为x除以y后的余数，所以两项相加就等于x</p>
<p>这两个模运算可以<strong>将整数分解成碎片</strong>，如下例</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">transmute(flights,  </span><br><span class="line">          dep_time,   </span><br><span class="line">          hour = dep_time %/% <span class="number">100</span>, </span><br><span class="line">          minute = dep_time %% <span class="number">100</span> ) </span><br><span class="line"><span class="comment">#把517分钟拆分成5小时和17分钟，结果如下          </span></span><br><span class="line"><span class="comment">#&gt; # A tibble: 336,776 x 3 </span></span><br><span class="line"><span class="comment">#&gt;   dep_time  hour minute</span></span><br><span class="line"><span class="comment">#&gt;       &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; </span></span><br><span class="line"><span class="comment">#&gt;        517     5     17</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="（3）对数运算符（logarithms）"><a href="#（3）对数运算符（logarithms）" class="headerlink" title="（3）对数运算符（logarithms）"></a>（3）对数运算符（logarithms）</h4><p><code>log(), log2(), log10().</code> </p>
<p>取对数是一种非常有用的转换，用于处理<strong>跨多个数量级</strong>的数据。 他们还<u>将乘法关系转换为<strong>加性</strong></u>，我们将在modeling章节中使用这一特性。<br>       在所有其他条件相同的情况下，我建议使用log2（），因为它很容易解释：对数刻度上的差异1对应于原始比例上的两倍，而-1上的差异对应于一半。</p>
<h4 id="（4）偏移量（offsets）"><a href="#（4）偏移量（offsets）" class="headerlink" title="（4）偏移量（offsets）"></a>（4）偏移量（offsets）</h4><p>lead() and lag() 可以引用前导值或滞后值（leading or lagging values）。这样就可以计算运行差异（ compute running differences ）【例    <code>x - lag(x)</code>】或者可以查找值在何时更改 【x != lag(x)】. 与group_by()结合使用时这俩函数最有用。</p>
<blockquote>
<p>需要在dplyr包启用时才有这俩函数。（未启用时也有lag但是用法不同）</p>
</blockquote>
<h4 id="（5）累计和滚动聚合（Cumulative-and-rolling-aggregates）"><a href="#（5）累计和滚动聚合（Cumulative-and-rolling-aggregates）" class="headerlink" title="（5）累计和滚动聚合（Cumulative and rolling aggregates）"></a>（5）累计和滚动聚合（Cumulative and rolling aggregates）</h4><p>R提供了用于运行  求和cumsum()，乘积cumprod()，最小值cummin()和最大值cummax()的函数； dplyr提供cummean() 来获取累积平均值。 如果您需要滚动聚合（即，在滚动窗口上计算的总和），请尝试使用RcppRoll包。</p>
<blockquote>
<p>结果逐个累积的，也就是括号内的x有多少个元素，就有多少个结果。</p>
</blockquote>
<h4 id="（6）逻辑比较（logical-comparisons）"><a href="#（6）逻辑比较（logical-comparisons）" class="headerlink" title="（6）逻辑比较（logical comparisons）"></a>（6）逻辑比较（logical comparisons）</h4><p>&lt;, &lt;=, &gt;, &gt;=, !=, and ==。</p>
<p>如果您要执行一系列复杂的逻辑运算，通常最好将临时值存储在新变量中，以便您可以检查每个步骤是否按预期工作。</p>
<h4 id="（7）排序（Ranking）"><a href="#（7）排序（Ranking）" class="headerlink" title="（7）排序（Ranking）"></a>（7）排序（Ranking）</h4>
        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2020/07/16/HelloBlog/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="WiiRong's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        903590780@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: 903590780@qq.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
                <li>
                    <a href="#" target="_blank" title="Linkedin">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">Linkedin</i>
                        
                        Linkedin
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2020/09/">九月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/07/">七月 2020<span class="sidebar_archives-count">5</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">cloud</i>
                
                标签云
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">6</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;WiiRong's Blog
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('
<link rel="stylesheet" href="/css/uc.css">
');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 0000;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
